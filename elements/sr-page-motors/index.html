<link rel="import" href="/bower_components/polymer/polymer.html" />
<link rel="import" href="../sr-core-pages/index.html" />
<link rel="import" href="../sr-core-toolbar/index.html" />
<link rel="import" href="../sr-motors/index.html" />
<link rel="import" href="../sr-wamp/index.html" />

<polymer-element name="sr-page-motors" extends="sr-core-page">
    <template>
        <style>
            #controllers {
                flex: 1 1 auto;
                display: flex;
            }

            sr-motors-board-controller {
                flex: 1 1 auto;
            }
        </style>

        <sr-core-toolbar id="toolbar">
            <h1 flex>Motor Control</h1>
        </sr-core-toolbar>

        <div id="controllers"></div>

        <sr-wamp-call
            auto="page"
            procedure="org.srobo.motors.all_boards"
            on-success="{{ handleAllBoardsSuccess }}"></sr-wamp-call>
    </template>

    <script>
        Polymer("sr-page-motors", {
            name: "motors",
            changeBoard: function(index) {
                var divs = this.$.controllers.children;
                for (var i = 0; i < divs.length; i++) {
                    divs[i].hidden = true;
                }
                this.shadowRoot.querySelector("#board_" + index).hidden = false;
            },
            createBoardButton: function(i, board) {
                var button = document.createElement("button");
                button.textContent = "Board " + board.serial_number;
                button.onclick = this.changeBoard.bind(this, i);
                return button;
            },
            createBoardDiv: function(i, board) {
                var div = document.createElement("sr-motors-board-controller");
                div.id = "board_" + i;
                div.board = i;
                return div;
            },
            handleAllBoardsSuccess: function(e) {
                this.$.controllers.innerHTML = "";

                var boards = e.detail.result;
                for (var i = 0; i < boards.length; i++) {
                    var button = this.createBoardButton(i, boards[i]);
                    var div = this.createBoardDiv(i, boards[i]);

                    this.$.toolbar.appendChild(button);
                    this.$.controllers.appendChild(div);
                }

                this.changeBoard(0);
            }
        });
    </script>
</polymer-element>
