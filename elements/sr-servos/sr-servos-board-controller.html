<link rel="import" href="/bower_components/polymer/polymer.html" />
<link rel="import" href="../sr-wamp/index.html" />
<link rel="import" href="sr-servos-servo-controller.html" />

<polymer-element name="sr-servos-board-controller" attributes="board">
    <template>
        <style>
            :host {
                padding: 10px;
                display: flex;
                overflow-x: auto;
            }

            sr-servos-servo-controller {
                flex: 1 1 auto;
            }
        </style>

        <sr-wamp-call
            id="wampGetBoard"
            procedure="org.srobo.servos.get_board"
            on-success="{{ handleGetBoardSuccess }}"></sr-wamp-call>
    </template>

    <script>
        Polymer("sr-servos-board-controller", {
            board: 0,
            domReady: function() {
                this.$.wampGetBoard.go([this.board]);
            },
            handleGetBoardSuccess: function(e) {
                var servos = e.detail.result.servos;
                servos.forEach(function(motor, i) {
                    var element = document.createElement("sr-servos-servo-controller");
                    element.board = this.board;
                    element.servo = i;
                    this.shadowRoot.appendChild(element);
                }.bind(this));
            }
        });
    </script>
</polymer-element>
