<link rel="import" href="/bower_components/polymer/polymer.html" />
<link rel="import" href="../../core/sr-pages/index.html" />
<link rel="import" href="../../core/sr-wamp/index.html" />
<link rel="import" href="../../core/sr-servo-controller/index.html" />

<polymer-element name="page-servos" extends="sr-page">
    <template>
        <style>
            h1 {
                margin: 15px 15px 5px;
            }

            :host > div {
                margin: 5px 15px 15px;
                flex: 1 1 auto;
                display: flex;
            }

            sr-servo-controller {
                flex: 1 1 auto;
            }
        </style>

        <h1>Servo Control</h1>

        <div>
            <sr-servo-controller servo="0"></sr-servo-controller>
            <sr-servo-controller servo="1"></sr-servo-controller>
            <sr-servo-controller servo="2"></sr-servo-controller>
            <sr-servo-controller servo="3"></sr-servo-controller>
            <sr-servo-controller servo="4"></sr-servo-controller>
            <sr-servo-controller servo="5"></sr-servo-controller>
            <sr-servo-controller servo="6"></sr-servo-controller>
            <sr-servo-controller servo="7"></sr-servo-controller>
        </div>

        <sr-wamp on-open="{{handleOpen}}">
            <sr-wamp-call
                id="call"
                procedure="org.srobo.servos"
                on-success="{{handleCallSuccess}}"></sr-wamp-call>
        </sr-wamp>
    </template>

    <script>
        Polymer("page-servos", {
            name: "servos",
            handleOpen: function() {
                this.$.call.go();
            },
            handleCallSuccess: function(e) {
                var servos = this.shadowRoot.querySelectorAll("sr-servo-controller");
                for (var i = 0; i < servos.length; i++) {
                    servos[i].value = e.detail.result[i].value;
                    servos[i].state = e.detail.result[i].state;
                }
            }
        });
    </script>
</polymer-element>
