<link rel="import" href="/bower_components/polymer/polymer.html" />
<link rel="import" href="/elements/core/sr-mode-picker.html" />
<link rel="import" href="/elements/core/sr-zone-picker.html" />
<link rel="import" href="/elements/core/sr-pages.html" />

<polymer-element name="page-setup" attributes="disabled" extends="sr-page">
    <template>
        <style>
            h1 {
                margin: 15px 15px 5px;
            }

            #first {
                margin: 5px 15px 15px;
                flex: 1 1 auto;
                align-self: center;
                justify-content: center;
            }

            #overlay {
                position: absolute;
                top: 0;
                left: 0;
                right: 0;
                bottom: 0;
                width: 100%;
                height: 100%;
                background: rgba(255, 255, 255, 0.95);
                display: none;
                flex-direction: column;
                align-self: center;
                justify-content: center;
            }

            #overlay.disabled {
                display: flex;
            }

            #overlay > h1 {
                align-self: center;
                font-size: 3em;
                font-weight: bold;
            }

            #overlay > p {
                align-self: center;
                font-size: 1.2em;
            }
        </style>

        <h1>Set up your robot</h1>

        <div id="first" vertical center layout>
            <div horizontal start layout>
                <div vertical center layout style="margin: 0 20px;">
                    <sr-zone-picker id="zonePicker"></sr-zone-picker>
                    <h2>Zone</h2>
                </div>

                <div vertical center layout style="margin: 0 20px;">
                    <sr-mode-picker id="modePicker"></sr-mode-picker>
                    <h2>Mode</h2>
                </div>
            </div>
        </div>

        <div id="overlay" class="{{ {disabled: disabled} | tokenList }}">
            <h1>Stop the robot first.</h1>
            <p>
                Mode: <strong>{{$.modePicker.mode === "dev" ? "Development" : "Competition"}}</strong><br />
                Zone: <strong>{{$.zonePicker.zone}}</strong><br />
                Project: <strong>{{project.name}}</strong> @ <strong>{{project.version}}</strong><br />
                Pyenv: <strong>{{pyenv.version}}</strong>
            </p>
        </div>

        <core-ajax
            id="getState"
            url="/state"
            handleAs="json"
            on-core-response="{{handleGetStateResponse}}"></core-ajax>

    </template>

    <script>
        Polymer("page-setup", {
            name: "setup",
            disabled: false,
            domReady: function() {
                this.$.getState.go();
                setInterval(this.$.getState.go.bind(this.$.getState), 5 * 1000);
            },
            handleGetStateResponse: function(e) {
                this.disabled = e.target.response.state !== "stopped";
                this.project = e.target.response.project;
                this.pyenv = e.target.response.pyenv;
            }
        });
    </script>
</polymer-element>
