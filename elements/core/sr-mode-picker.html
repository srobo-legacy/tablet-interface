<link rel="import" href="/bower_components/polymer/polymer.html" />

<polymer-element name="sr-mode-picker" attributes="mode">
    <template>
        <style>
            :host {
                display: flex;
                flex-direction: column;
            }

            button {
                margin: 6px;
                padding: 6px;
                border-radius: 2px;
                border: none;
                line-height: 1;
            }

            button::before {
                content: attr(data-zone);
            }

            button.selected {
                background: rgb(180, 180, 180);
                box-shadow: inset 0 0 20px rgb(10, 10, 10);
            }

            h1 {
                margin: 10px;
            }
        </style>

        <button data-mode="dev" class="{{ {selected: mode == 'dev'} | tokenList }}">
            <h1>Development</h1>
        </button>

        <button data-mode="comp" class="{{ {selected: mode == 'comp'} | tokenList }}">
            <h1>Competition</h1>
        </button>

        <core-ajax
            id="get"
            url="/settings/mode"
            handleAs="json"
            on-core-response="{{handleGetResponse}}"></core-ajax>

        <core-ajax
            id="put"
            method="PUT"
            url="/settings/mode"
            handleAs="json"
            on-core-response="{{handlePutResponse}}"></core-ajax>

    </template>

    <script>
        Polymer("sr-mode-picker", {
            mode: "dev",
            domReady: function() {
                var buttons = this.shadowRoot.querySelectorAll("button");
                for (var i = 0; i < buttons.length; i++) {
                    (function(btn) {
                        btn.addEventListener("click", function(e) {
                            this.mode = btn.dataset.mode;
                            this.$.put.body = JSON.stringify({mode: this.mode});
                            this.$.put.go();
                        }.bind(this));
                    }.bind(this)(buttons[i]));
                }

                this.$.get.go();

                setInterval(this.$.get.go.bind(this.$.get), 60 * 1000);
            },
            handleGetResponse: function(e) {
                // TODO implement based on server response
            },
            handlerPutResponse: function(e) {
                // TODO implement based on server response
            }
        });
    </script>
</polymer-element>
