<link rel="import" href="/bower_components/polymer/polymer.html" />
<link rel="import" href="/bower_components/core-ajax/core-ajax.html">

<polymer-element name="sr-zone-picker" attributes="zone">
    <template>
        <style>
            :host {
                display: block;
            }

            button {
                width: 64px;
                height: 64px;
                margin: 6px;
                padding: 6px;
                font-size: 2em;
                border-radius: 2px;
                border: none;
                box-shadow: 0 0 3px rgb(250, 250, 250);
            }

            button::before {
                content: attr(data-zone);
            }

            button.selected {
                box-shadow: inset 0 0 32px black;
            }
        </style>

        <!-- TODO fetch these buttons from the competition API? -->

        <button data-zone="0" style="background: #00ff00" class="{{ {selected: zone == 0} | tokenList }}"></button>
        <button data-zone="1" style="background: #ff6600" class="{{ {selected: zone == 1} | tokenList }}"></button>
        <br />
        <button data-zone="2" style="background: #ff00ff" class="{{ {selected: zone == 2} | tokenList }}"></button>
        <button data-zone="3" style="background: #ffff00" class="{{ {selected: zone == 3} | tokenList }}"></button>

        <core-ajax
            id="get"
            url="/settings/zone"
            handleAs="json"
            on-core-response="{{handleGetResponse}}"></core-ajax>

        <core-ajax
            id="put"
            method="PUT"
            url="/settings/zone"
            handleAs="json"
            on-core-response="{{handlePutResponse}}"></core-ajax>

    </template>

    <script>
        Polymer("sr-zone-picker", {
            zone: "0",
            domReady: function() {
                var buttons = this.shadowRoot.querySelectorAll("button");
                for (var i = 0; i < buttons.length; i++) {
                    buttons[i].addEventListener("click", function(e) {
                        this.zone = e.target.dataset.zone;
                        this.$.put.body = JSON.stringify({zone: this.zone});
                        this.$.put.go();
                    }.bind(this));
                }

                this.$.get.go();

                setInterval(this.$.get.go.bind(this.$.get), 60 * 1000);
            },
            handleGetResponse: function(e) {
                // TODO implement based on server response
            },
            handlerPutResponse: function(e) {
                // TODO implement based on server response
            }
        });
    </script>
</polymer-element>
