<!--
`sr-logs-current` provides a view of the current log.

Example:

    <sr-logs-current></sr-logs-current>

@group SR Logs Elements
@element sr-logs-current
-->

<link rel="import" href="/bower_components/polymer/polymer.html" />
<link rel="import" href="../wamp/index.html" />
<link rel="import" href="textarea.html" />

<polymer-element name="sr-logs-current">
    <template>
        <style>
            :host {
                display: flex;
            }
        </style>

        <sr-logs-textarea id="log"></sr-logs-textarea>

        <sr-wamp-subscribe
            auto="wamp"
            topic="org.srobo.log"
            on-handle="{{ handleLog }}"></sr-wamp-subscribe>
        <sr-wamp-call
            auto="wamp"
            procedure="org.srobo.logs.current"
            on-success="{{ handleLog }}"></sr-wamp-call>
    </template>

    <script>
        Polymer("sr-logs-current", {
            handleLog: function(e) {
                if (e.detail.result !== undefined) {
                    this.$.log.clear();
                    var text = e.detail.result.trim();
                    if (text.length > 0) {
                        this.$.log.addEntry("-- Previous Log Starts Here --");
                        this.$.log.addEntry(text, false);
                        this.$.log.addEntry("-- Previous Log Ends Here --");
                        this.$.log.scrollToBottom();
                    }
                } else {
                    this.$.log.addEntry(e.detail.args[0]);
                }
            },
            scrollToBottom: function() {
                this.$.log.scrollToBottom();
            }
        });
    </script>
</polymer-element>
