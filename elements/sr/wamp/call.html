<!--
`sr-wamp-call` provides a convenient way of making a WAMP call.

Example:

    <sr-wamp-call
        auto="wamp"
        procedure="my.rpc.call"></sr-wamp-call>

@group SR WAMP Elements
@element sr-wamp-call
-->

<link rel="import" href="/bower_components/polymer/polymer.html" />
<link rel="import" href="core.html" />

<dom-module id="sr-wamp-call">
  <template>
    <style>
      :host {
        display: none;
      }
    </style>

    <sr-wamp-core id="wamp" on-open="{{ handleOpen }}"></sr-wamp-core>
  </template>

  <script>
    Polymer({
      is: "sr-wamp-call",

      properties: {
        procedure: String,
        auto: String,
      },

      handleOpen: function() {
        if (this.auto === "wamp") {
          this.go();
        }
      },
      onPageShow: function() {
        if (this.auto === "page") {
          this.go();
        }
      },
      go: function(args, kwargs, options) {
        this.$.wamp.call(this.procedure, args, kwargs, options).then(function(result) {
          this.fire("success", {result: result});
        }.bind(this));
      }
    });
  </script>
</dom-module>
