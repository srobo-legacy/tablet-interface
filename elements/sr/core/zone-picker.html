<!--
`sr-core-zone-picker` provides a button selection for the current zone.

Example:

    <sr-core-zone-picker></sr-core-zone-picker>

You can get/set the current zone using the `zone` attribute.

@group SR Core Elements
@element sr-core-zone-picker
-->

<link rel="import" href="/bower_components/polymer/polymer.html" />
<link rel="import" href="../wamp/index.html" />

<polymer-element name="sr-core-zone-picker" attributes="zone">
    <template>
        <style>
            :host {
                display: block;
            }

            button {
                width: 64px;
                height: 64px;
                margin: 6px;
                padding: 6px;
                font-size: 2em;
                border-radius: 2px;
                border: none;
                box-shadow: 0 0 3px rgb(250, 250, 250);
            }

            button::before {
                content: attr(data-zone);
            }

            button.selected {
                box-shadow: inset 0 0 32px black;
            }
        </style>

        <!-- TODO fetch the colours from the competition API? -->

        <button
            data-zone="0"
            style="background: #00ff00"
            class="{{ {selected: zone == 0} | tokenList }}"></button>
        <button
            data-zone="1"
            style="background: #ff6600"
            class="{{ {selected: zone == 1} | tokenList }}"></button>

        <br />

        <button
            data-zone="2"
            style="background: #ff00ff"
            class="{{ {selected: zone == 2} | tokenList }}"></button>
        <button
            data-zone="3"
            style="background: #ffff00"
            class="{{ {selected: zone == 3} | tokenList }}"></button>

        <sr-wamp-subscribe
            auto="wamp"
            topic="org.srobo.zone"
            on-handle="{{ handleZone }}"></sr-wamp-subscribe>
        <sr-wamp-publish
            id="wampPublishZone"
            topic="org.srobo.zone"></sr-wamp-publish>
        <sr-wamp-call
            auto="wamp"
            procedure="org.srobo.zone"
            on-success="{{ handleZone }}"></sr-wamp-call>
    </template>

    <script>
        Polymer("sr-core-zone-picker", {
            zone: undefined,
            domReady: function() {
                var buttons = this.shadowRoot.querySelectorAll("button");
                for (var i = 0; i < buttons.length; i++) {
                    buttons[i].addEventListener("click", function(e) {
                        this.zone = e.target.dataset.zone;
                        this.publishZone();
                    }.bind(this));
                }
            },
            publishZone: function(zone) {
                if (zone === undefined) {
                    zone = this.zone;
                }

                this.$.wampPublishZone.go([parseInt(zone)]);
            },
            handleZone: function(e) {
                if (e.detail.result !== undefined) {
                    this.zone = e.detail.result;
                } else {
                    this.zone = e.detail.args[0];
                }
            }
        });
    </script>
</polymer-element>
