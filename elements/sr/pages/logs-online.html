<!--
`sr-pages-logs-online` provides the online version of the logs page. The logs
page allows you to see the current and previous log(s).

Example:

    <sr-core-page online="sr-pages-logs-online"></sr-core-page>

@group SR Pages Elements
@element sr-pages-logs-online
-->

<link rel="import" href="/bower_components/polymer/polymer.html" />
<link rel="import" href="../logs/index.html" />
<link rel="import" href="../ui/index.html" />
<link rel="import" href="../wamp/index.html" />

<polymer-element name="sr-pages-logs-online">
    <template>
        <style>
            :host {
                flex: 1 1 auto;
                display: flex;
                flex-direction: column;
            }

            sr-logs-current,
            textarea {
                flex: 1 1 auto;
                font-family: "Inconsolate", monospace !important; /* :( */
            }

            #logs {
                display: flex;
                flex: 1 1 auto;
                padding: 10px;
            }
        </style>

        <sr-ui-toolbar>
            <h1 flex>View Robot Logs</h1>
            <select id="logSelection" on-change="{{ handleLogSelectionChanged }}">
                <optgroup label="Current Log">
                    <option value="current">Current</option>
                </optgroup>
                <optgroup label="Previous Logs" id="previousLogs">

                </optgroup>
            </select>
            <button id="btnBottom">Jump to bottom</button>
        </sr-ui-toolbar>

        <div id="logs">
            <sr-logs-current id="log_current"></sr-logs-current>
        </div>

        <sr-wamp-call
            auto="wamp"
            procedure="org.srobo.old_logs"
            on-success="{{ handleOldLogs }}"></sr-wamp-call>
    </template>

    <script>
        Polymer("sr-pages-logs-online", {
            domReady: function() {
                this.$.btnBottom.addEventListener("click",
                    this.$.log_current.scrollToBottom.bind(this.$.log_current));
            },
            handleOldLogs: function(e) {
                var oldLogs = e.detail.result || e.detail.args[0];

                this.$.previousLogs.innerHTML = "";

                for (var i = 0; i < oldLogs.length; i++) {
                    var option = document.createElement("option");
                    option.value = "old_" + i;
                    option.textContent = i;
                    this.$.previousLogs.appendChild(option);

                    var textarea = document.createElement("textarea");
                    textarea.id = "log_old_" + i;
                    textarea.textContent = oldLogs[i];
                    textarea.readOnly = true;
                    textarea.hidden = true;
                    this.$.logs.appendChild(textarea);
                }
            },
            changeLog: function(log) {
                console.log("Changing log:", log);

                var logs = this.$.logs.children;
                for (var i = 0; i < logs.length; i++) {
                    logs[i].hidden = true;
                }

                this.shadowRoot.querySelector("#log_" + log).hidden = false;
            },
            handleLogSelectionChanged: function(e) {
                this.changeLog(this.$.logSelection.value);
            }
        });
    </script>
</polymer-element>
