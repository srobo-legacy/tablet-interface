<link rel="import" href="/bower_components/polymer/polymer.html" />
<link rel="import" href="../sr-core-pages/index.html" />
<link rel="import" href="../sr-wamp/index.html" />

<polymer-element name="sr-page-camera" extends="sr-core-page">
    <template>
        <style>
            :host {
                flex-direction: row;
            }

            #current {
                flex: 1 1 auto;
                display: flex;
            }

            #old {
                flex: 0 0 auto;
                display: flex;
                flex-direction: column;
                overflow: auto;
            }

            img {
                object-fit: contain;
            }

            #current img {
                flex: 1 1 auto;
            }

            #old img {
                flex: 0 0 auto;
                width: 200px;
            }
        </style>

        <div id="current">
            <img id="image"></img>
        </div>

        <div id="old"></div>

        <sr-wamp-subscribe
            auto="page"
            topic="org.srobo.camera.image"
            on-handle="{{handleImage}}"></sr-wamp-subscribe>
    </template>

    <script>
        Polymer("sr-page-camera", {
            name: "camera",
            addOldImage: function(src) {
                var img = document.createElement("img");
                img.src = src;
                this.$.old.appendChild(img);
            },
            handleImage: function(e) {
                if (this.$.image.src) {
                    this.addOldImage(this.$.image.src);
                }

                var src = "data:image/jpeg;base64," + e.detail.args[0];
                this.$.image.src = src;
            }
        });
    </script>
</polymer-element>
